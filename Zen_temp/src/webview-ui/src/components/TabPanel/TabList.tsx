import React from "react";
import { getProviderIconPath } from "../../utils/fileIconMapper";

interface TabInfo {
  tabId: number;
  containerName: string;
  title: string;
  url?: string;
  status: "free" | "busy" | "sleep";
  canAccept: boolean;
  requestCount: number;
  folderPath?: string | null;
  conversationId?: string | null;
  provider?:
    | "deepseek"
    | "chatgpt"
    | "gemini"
    | "grok"
    | "claude"
    | "claude-cli";
  cookieStoreId?: string;
  // Claude CLI specific fields
  accountId?: string;
  email?: string;
  username?: string;
  reqCount?: number;
  inputTokens?: number;
  outputTokens?: number;
}

interface TabListProps {
  tabs: TabInfo[];
  onTabSelect?: (tab: TabInfo) => void;
  activeTabId?: number;
}

const TabList: React.FC<TabListProps> = ({
  tabs,
  onTabSelect,
  activeTabId,
}) => {
  const getStatusColor = (status: string): string => {
    if (status === "busy") return "bg-yellow-500";
    if (status === "sleep") return "bg-purple-500";
    return "bg-green-500";
  };

  const getStatusBadge = (status: string): string => {
    if (status === "busy") return "Processing";
    if (status === "sleep") return "Sleeping";
    return "Free";
  };

  if (tabs.length === 0) {
    return (
      <div
        style={{
          padding: "var(--spacing-xl)",
          textAlign: "center",
          color: "var(--secondary-text)",
          fontSize: "var(--font-size-sm)",
        }}
      >
        <div
          style={{
            fontSize: "var(--font-size-xxl)",
            marginBottom: "var(--spacing-md)",
          }}
        >
          üîå
        </div>
        <p>No AI tabs detected</p>
        <p
          style={{
            fontSize: "var(--font-size-xs)",
            marginTop: "var(--spacing-xs)",
          }}
        >
          Open AI chat websites to see active tabs
        </p>
      </div>
    );
  }

  const getProviderInfo = (
    provider?:
      | "deepseek"
      | "chatgpt"
      | "gemini"
      | "grok"
      | "claude"
      | "claude-cli"
  ): { name: string; emoji: string; bgColor: string; textColor: string } => {
    switch (provider) {
      case "deepseek":
        return {
          name: "DeepSeek",
          emoji: "ü§ñ",
          bgColor: "rgba(59, 130, 246, 0.1)",
          textColor: "#3b82f6",
        };
      case "chatgpt":
        return {
          name: "ChatGPT",
          emoji: "üí¨",
          bgColor: "rgba(16, 185, 129, 0.1)",
          textColor: "#10b981",
        };
      case "claude":
        return {
          name: "Claude",
          emoji: "üß†",
          bgColor: "rgba(245, 158, 11, 0.1)",
          textColor: "#f59e0b",
        };
      case "claude-cli":
        return {
          name: "Claude(CLI)",
          emoji: "üîß",
          bgColor: "rgba(139, 92, 246, 0.1)",
          textColor: "#8b5cf6",
        };
      case "gemini":
        return {
          name: "Gemini",
          emoji: "‚ú®",
          bgColor: "rgba(168, 85, 247, 0.1)",
          textColor: "#a855f7",
        };
      case "grok":
        return {
          name: "Grok",
          emoji: "‚ö°",
          bgColor: "rgba(249, 115, 22, 0.1)",
          textColor: "#f97316",
        };
      default:
        return {
          name: "Unknown",
          emoji: "‚ùì",
          bgColor: "rgba(107, 114, 128, 0.1)",
          textColor: "#6b7280",
        };
    }
  };

  return (
    <div
      style={{
        padding: "var(--spacing-md)",
        display: "flex",
        flexDirection: "column",
        gap: "var(--spacing-sm)",
      }}
    >
      <div
        style={{
          fontSize: "var(--font-size-xs)",
          fontWeight: 600,
          color: "var(--secondary-text)",
          letterSpacing: "0.5px",
          padding: "0 var(--spacing-sm)",
        }}
      >
        ACTIVE AI TABS ({tabs.length})
      </div>
      {tabs.map((tab) => {
        const providerInfo = getProviderInfo(tab.provider);
        return (
          <div
            key={tab.tabId}
            style={{
              padding: "var(--spacing-md)",
              backgroundColor: "var(--secondary-bg)",
              border:
                tab.tabId === activeTabId
                  ? "2px solid #FFD700" // Sparkling gold
                  : "1px solid var(--border-color)",
              boxShadow:
                tab.tabId === activeTabId
                  ? "0 0 10px rgba(255, 215, 0, 0.3)"
                  : "none",
              borderRadius: "var(--border-radius)",
              transition: "all 0.2s",
              cursor: tab.canAccept ? "pointer" : "not-allowed",
              opacity: tab.canAccept ? 1 : 0.6,
            }}
            onClick={() => {
              if (tab.canAccept) {
                onTabSelect?.(tab);
              }
            }}
            onMouseEnter={(e) => {
              if (tab.canAccept) {
                e.currentTarget.style.backgroundColor = "var(--hover-bg)";
                e.currentTarget.style.borderColor = "var(--accent-text)";
              }
            }}
            onMouseLeave={(e) => {
              if (tab.canAccept) {
                e.currentTarget.style.backgroundColor = "var(--secondary-bg)";
                e.currentTarget.style.borderColor = "var(--border-color)";
              }
            }}
          >
            <div
              style={{
                display: "flex",
                alignItems: "center",
                gap: "var(--spacing-sm)",
                marginBottom: "var(--spacing-xs)",
              }}
            >
              <span
                style={{
                  fontSize: "10px",
                  fontWeight: 600,
                  color: providerInfo.textColor,
                  backgroundColor: providerInfo.bgColor,
                  padding: "2px 6px",
                  borderRadius: "4px",
                  display: "inline-flex",
                  alignItems: "center",
                  gap: "6px",
                }}
              >
                <img
                  src={getProviderIconPath(tab.provider || "openai")}
                  alt={providerInfo.name}
                  style={{ width: "12px", height: "12px" }}
                />
                {providerInfo.name}
              </span>
              <span
                style={{
                  fontSize: "var(--font-size-md)",
                  fontWeight: 600,
                  color: "var(--primary-text)",
                  flex: 1,
                  overflow: "hidden",
                  textOverflow: "ellipsis",
                  whiteSpace: "nowrap",
                }}
              >
                {tab.title}
              </span>
              {tab.folderPath && (
                <div
                  style={{
                    fontSize: "var(--font-size-xs)",
                    color: "var(--accent-text)",
                    display: "flex",
                    alignItems: "center",
                    gap: "var(--spacing-xs)",
                    backgroundColor: "rgba(99, 102, 241, 0.1)",
                    padding: "2px 6px",
                    borderRadius: "4px",
                    maxWidth: "150px",
                  }}
                >
                  <span>üìÅ</span>
                  <span
                    style={{
                      overflow: "hidden",
                      textOverflow: "ellipsis",
                      whiteSpace: "nowrap",
                    }}
                    title={tab.folderPath}
                  >
                    {tab.folderPath.split("/").pop() || tab.folderPath}
                  </span>
                </div>
              )}
            </div>

            <div
              style={{
                display: "flex",
                alignItems: "center",
                flexWrap: "wrap",
                gap: "var(--spacing-sm)",
                fontSize: "var(--font-size-xs)",
                color: "var(--secondary-text)",
              }}
            >
              {tab.provider === "claude-cli" ? (
                // Claude CLI account display
                <>
                  {tab.email && (
                    <>
                      <span>üìß {tab.email}</span>
                      <span>‚Ä¢</span>
                    </>
                  )}
                  {tab.username && (
                    <>
                      <span>üë§ {tab.username}</span>
                      <span>‚Ä¢</span>
                    </>
                  )}
                  {tab.reqCount !== undefined && (
                    <>
                      <span>{tab.reqCount} requests</span>
                      <span>‚Ä¢</span>
                    </>
                  )}
                  {tab.inputTokens !== undefined && (
                    <>
                      <span>üì• {tab.inputTokens.toLocaleString()} in</span>
                      <span>‚Ä¢</span>
                    </>
                  )}
                  {tab.outputTokens !== undefined && (
                    <span>üì§ {tab.outputTokens.toLocaleString()} out</span>
                  )}
                </>
              ) : (
                // Browser tab display
                <>
                  <span style={{ fontFamily: "monospace" }}>
                    ID: {tab.tabId}
                  </span>
                  <span>‚Ä¢</span>
                  <span>{tab.requestCount} requests</span>
                  <span>‚Ä¢</span>
                  <span
                    style={{
                      color:
                        tab.status === "busy"
                          ? "#ff9800"
                          : tab.status === "sleep"
                          ? "#9c27b0"
                          : "#4caf50",
                      fontWeight: 600,
                    }}
                  >
                    {getStatusBadge(tab.status)}
                  </span>
                  {tab.containerName &&
                    !tab.containerName.startsWith("Tab ") && (
                      <>
                        <span>‚Ä¢</span>
                        <span
                          style={{
                            display: "inline-flex",
                            alignItems: "center",
                            gap: "4px",
                            fontSize: "var(--font-size-xs)",
                            color: "#6366f1",
                          }}
                        >
                          <span style={{ fontSize: "10px" }}>üóÇÔ∏è</span>
                          <span
                            style={{
                              overflow: "hidden",
                              textOverflow: "ellipsis",
                              whiteSpace: "nowrap",
                              maxWidth: "100px",
                            }}
                            title={tab.containerName}
                          >
                            {tab.containerName}
                          </span>
                        </span>
                      </>
                    )}
                </>
              )}
            </div>

            {(() => {
              return null;
            })()}

            {tab.conversationId && (
              <div
                style={{
                  marginTop: "2px",
                  fontSize: "var(--font-size-xs)",
                  color: "var(--secondary-text)",
                  display: "flex",
                  alignItems: "center",
                  gap: "var(--spacing-xs)",
                }}
              >
                <span>üí¨</span>
                <span
                  style={{
                    overflow: "hidden",
                    textOverflow: "ellipsis",
                    whiteSpace: "nowrap",
                    maxWidth: "200px",
                  }}
                  title={tab.conversationId}
                >
                  {tab.conversationId}
                </span>
              </div>
            )}
          </div>
        );
      })}
    </div>
  );
};

export default TabList;
